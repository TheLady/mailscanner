#!/usr/bin/env python
'''
server

Usage:
    server <output_model_weights> <output_model_codec>

This is the server module to create a `connexion` application using a pretrained model.
'''

import os

import connexion
import docopt

import mailscanner

PORT = os.environ.get('PORT', 5000)
DEBUG = os.environ.get('DEBUG', False)

SERVER_IN = os.path.join(os.path.dirname(os.path.abspath(__file__)), '../mailscanner')
# WSGI module level variable
application = connexion.App(__name__, port=PORT, specification_dir=SERVER_IN)
application.add_api('./server/api.yml')


if __name__ == '__main__':
    arguments = docopt.docopt(__doc__, version=mailscanner.__version__)
    mailscanner.server.replies.load_model_codec(arguments['<output_model_weights>'], arguments['<output_model_codec>'])
    application.run(debug=DEBUG)
